<html>

<head>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <title>Should I Deploy Today?</title>
    <link rel="stylesheet" href="style.css">

</head>

<body onload="getdate()">
    <div class="container">
        <div id="main" class="wrapper">
            <div class="item">
                <h3 class="tagline">should i deploy?</h3>
                <h2 class="reason" id="text"></h2>
                <span id="reload" onclick="getdate()">
                    Hit <span class="space-btn">Space</span> or Click
                </span>
            </div>
            <div class="meta"></div>
        </div>
    </div>
</body>
<script>
    const getdate = () => {
        let params = new URL(document.location.toString()).searchParams;
        let timeZone = params.get("tz");
        let date = params.get("date")
        if (!timeZone) {
            timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone || "UTC"
        }
        let query = `tz=${timeZone}`
        if (date) {
            query += `&date=${date}`
        }

        fetch(`/api?${query}`).then(data => data.json()).then(data => {
            document.getElementById("text").innerText = data.message
            const sid = data.shouldIDeploy
            const elem = document.getElementById("main")
            if (sid) {
                elem.classList.remove("its-friday")
            } else {
                elem.classList.add("its-friday")
            }

        }).catch(err => console.error(err))
    }
    document.body.onkeyup = function (e) {
        if (e.key == " " ||
            e.code == "Space" ||
            e.keyCode == 32
        ) {
            getdate()
        }
    }
</script>

</html>